/**
 * flexible, event-driven web workers for modern browsers
 * @version v0.1.1 - 2015-05-29
 * @author Kevin James <kevinjamesus86@gmail.com>
 * Copyright (c) 2015 Kevin James
 * Licensed under the MIT license.
 */
!function(a,b){"function"==typeof define&&define.amd?define([],b):"object"==typeof exports?module.exports=b():a.spawn=b()}(this,function(){"use strict";function a(a){this.isMainThread=!0;var f;"string"==typeof a?f=d:"function"==typeof a&&(f=a,a=null),this.file=c.createObjectURL(new Blob([e()+"("+f.toString()+").call(self);"],{type:"text/javascript"})),this.worker=new b(this.file),this._init(),a&&this.importScripts(a)}var b=window.Worker,c=window.URL||window.webkitURL,d=function(){};a.fn=a.prototype,a.fn.uuid=function(){var a=this.isMainThread?"spawn_":"worker_";return a+Date.now().toString(32)+Math.random().toString(32)},a.fn.location={origin:location.origin,originPath:location.href.match(/^(.*\/)?(?:$|(.+?)(?:(\.[^.]*$)|$))/)[1].replace(/\/?$/,"")+"/"},a.fn.on=function(a,b){if("object"==typeof a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&this.on(c,a[c]);else this.callbacks[a]=this.callbacks[a]||[],this.callbacks[a].push(b);return this},a.fn.emit=function(a,b,c,d){var e=!1;return"function"==typeof b?(c=b,b=null):"string"==typeof c&&(d=c),d=d||this.uuid(),"function"==typeof c&&(this.acks[d]=c,e=!0),this.worker.postMessage({id:d,event:a,data:b,ack:e}),this},a.fn._invoke=function(a,b,c,d){function e(a){d&&g.emit("spawn_ack",a,c)}var f=this.callbacks[a],g=this;if(f)for(var h=f.length,i=-1;++i<h;)f[i](b,e)},a.fn.close=function(){return this.isWorker?(this.emit("spawn_close"),this.worker.close()):this.worker.terminate(),this.acks={},this.callbacks={},this.worker.onerror=this.worker.onmessage=null,c.revokeObjectURL(this.file),this},a.fn["import"]=a.fn.importScripts=function(){var a=Array.prototype.slice.call(arguments,0);if(this.isMainThread)this.emit("spawn_import",a);else{for(var b,c=a.length,d=-1;++d<c;)b=a[d],"/"===b.charAt(0)?a[d]=this.location.origin+b:/^https?:/.test(b)||(a[d]=this.location.originPath+b);importScripts.apply(self,a)}return this},a.fn._init=function(){var a=this;a.acks={},a.callbacks={},a.worker.onmessage=function(b){var c=b.data.data,d=b.data.event,e=b.data.id;switch(d){case"spawn_ack":a.acks[e](c),delete a.acks[e];break;case"spawn_import":a.importScripts.apply(a,c);break;case"spawn_close":a.close();break;default:a._invoke(d,c,e,b.data.ack)}},a.isMainThread&&(a.worker.onerror=function(b){a._invoke("error",b)})};var e=function(){var b=Object.keys(a.fn).reduce(function(b,c){var d=a.fn[c];return d="function"==typeof d?d.toString():JSON.stringify(d),b+"Spawn.fn."+c+"="+d+";"},"");return function(){return["self.spawn = (function() {","function Spawn() {","this.isWorker = true;","this.worker = self;","this._init();","}","Spawn.fn=Spawn.prototype;",b,"return new Spawn;","})();"].join("\n")}}();return function(b){return new a(b)}});