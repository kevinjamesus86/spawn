/**
 * spawn! event-driven web workers for modern browsers
 * @version v1.0.6 - 2015-11-19
 * @author Kevin James <kevinjamesus86@gmail.com>
 * Copyright (c) 2015 Kevin James
 * Licensed under the MIT license.
 * https://github.com/kevinjamesus86/spawn
 */
!function(a,b){"function"==typeof define&&define.amd?define([],b):"object"==typeof exports?module.exports=b():a.Spawn=b()}(this,function(){"use strict";function a(b,c){if(!(this instanceof a))return new a(b,c);c=h({},a.config,c);var e,f="";"string"==typeof b?e=b:"function"==typeof b&&(f=k(b)),this.isMainThread=!0,this.file=l('importScripts("'+n+'");\nspawn.exportAs("'+c.workerAs+'");\n'+f),this.worker=new d(this.file),this._init(),e&&this.importScripts(e)}var b,c=window,d=c.Worker,e=c.URL||c.webkitURL,f=Object.prototype.hasOwnProperty,g=c.Blob;g||(b=c.BlobBuilder||c.WebKitBlobBuilder||c.MozBlobBuilder||c.MSBlobBuilder);var h=function(a){var b=Array.prototype.slice.call(arguments,1);return b.forEach(function(b){if(b)for(var c in b)f.call(b,c)&&(a[c]=b[c])}),a},i=/((['"`])(|[\s\S]*?[^\\])\2)|\/\/.*$|\/\*[\s\S]*?\*\//gm,j=/^function\s*[^{]*\{([\s\S]*)\}$/m,k=function(a){return a.toString().replace(i,"$1").replace(j,"$1")},l=function(a){var c,d="application/javascript";return g?c=new g([a],{type:d}):(c=new b,c.append(a),c=c.getBlob(d)),e.createObjectURL(c)},m={workerAs:"spawn"};a.fn=a.prototype,a.config=h(m),a.fn.uuid=function(){var a=this.isMainThread?"spawn_":"worker_";return a+Date.now().toString(32)+Math.random().toString(32)},a.fn.location={origin:location.origin||location.protocol+"//"+location.host,originPath:location.href.match(/^(.*\/)?(?:$|(.+?)(?:(\.[^.]*$)|$))/)[1].replace(/\/?$/,"")+"/"},a.fn.on=function(a,b){return this.callbacks[a]=this.callbacks[a]||[],this.callbacks[a].push(b),this},a.fn.emit=function(a,b,c,d){var e=!1;return"function"==typeof b?(c=b,b=null):"string"==typeof c&&(d=c),d=d||this.uuid(),"function"==typeof c&&(this.acks[d]=c,e=!0),this.worker.postMessage({id:d,event:a,data:b,ack:e}),this},a.fn._invoke=function(a,b,c,d){function e(a){d&&g.emit("spawn_ack",a,c)}var f=this.callbacks[a],g=this;if(f)for(var h=f.length,i=-1;++i<h;)f[i].call(g,b,e)},a.fn.close=function(){return this.isWorker?(this.emit("spawn_close"),this.worker.close()):(this.closed=!0,this.worker.terminate(),e.revokeObjectURL(this.file),this.on=this.emit=this.close=this.importScripts=function(){return this},this.worker.removeEventListener("message",this._messageHandler,!1),this.worker.removeEventListener("error",this._errorHandler,!1),this.acks=this.callbacks=this.file=this.worker=null),this},a.fn.importScripts=function(){var a=Array.prototype.slice.call(arguments,0);if(this.isMainThread)this.emit("spawn_import",a);else{for(var b,c=a.length,d=-1;++d<c;)b=a[d],"/"===b.charAt(0)?a[d]=this.location.origin+b:/^(blob|https?)(:|%3a)/i.test(b)||(a[d]=this.location.originPath+b);importScripts.apply(self,a)}return this},a.fn._init=function(){var a=this;a.acks={},a.callbacks={},a._messageHandler=a._messageHandler.bind(a),a.worker.addEventListener("message",a._messageHandler,!1),a.isMainThread&&(a._errorHandler=a._errorHandler.bind(a),a.worker.addEventListener("error",a._errorHandler,!1))},a.fn._messageHandler=function(a){var b,c=this,d=a.data.data,e=a.data.event,f=a.data.id;switch(e){case"spawn_ack":b=c.acks[f],delete c.acks[f],b.call(c,d);break;case"spawn_import":c.importScripts.apply(c,d);break;case"spawn_close":c.close();break;default:c._invoke(e,d,f,a.data.ack)}},a.fn._errorHandler=function(a){this._invoke("error",a)};var n=function(){var b=Object.keys(a.fn).reduce(function(b,c){var d=a.fn[c];return d="function"==typeof d?d.toString():JSON.stringify(d),b+"Spawn.fn."+c+"="+d+";"},"");return l("self.spawn = (function() {function Spawn() {this.isWorker = true;this.worker = self;this._init();}Spawn.fn=Spawn.prototype;"+b+"var instance;var prevExport;Spawn.fn.exportAs = function(name) {self[name] = instance;if (prevExport) {delete self[prevExport];}prevExport = name;};return (instance = new Spawn);})();")}();return a});